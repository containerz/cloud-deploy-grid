---
- name: create dcos directories
  file:
    path: /dcos/genconf
    state: directory
  tags:
    - terminal

- name: create ipdetect script
  template:
    src: dcos/genconf/ip-detect
    dest: /dcos/genconf/ip-detect
    owner: root
    group: root
    mode: 0755
  tags:
    - terminal

- name: create dcos config
  template:
    src: dcos/genconf/config.json
    dest: /dcos/genconf/config.json
    owner: root
    group: root
    mode: 0644
  tags:
    - terminal

- name: download dcos setup file
  get_url:
    url: http://downloads.mesosphere.com/dcos/stable/dcos_generate_config.sh
    dest: /dcos/dcos_generate_config.sh
    mode: 0755
  tags:
    - terminal

- name: extract dcos setup content
  command: ./dcos_generate_config.sh
  args:
    chdir: /dcos
    creates: /path/to/database

- name: dcos setup container
  docker:
    name: nginx
    image: nginx
    state: started
    ports:
      - "28080:80"
    volumes:
      - "/dcos/genconf/serve:/usr/share/nginx/html:ro"